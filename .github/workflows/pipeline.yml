name: CI/CD Pipeline

on:
  push:
    branches:
      - main
  pull_request:
  workflow_dispatch:

jobs:
  pipeline:
    uses: bb-claw/ci-workflows/.github/workflows/full-pipeline.yml@v1
    with:
      dev-url: ${{ vars.RAILWAY_PRIMARY_URL || 'https://openclaw-builder-dev3.up.railway.app' }}
      prod-url: ${{ vars.RAILWAY_BUDDY_URL || 'https://openclaw-buddy-dev3.up.railway.app' }}
      railway-service-id-dev: ${{ vars.RAILWAY_SERVICE_ID }}
      railway-service-id-prod: ${{ vars.RAILWAY_BUDDY_SERVICE_ID }}
      dockerfile: ./Dockerfile
      health-check-path: /health
      integration-test-command: bash scripts/integration-tests.sh
      unit-test-command: npm run smoke
    secrets: inherit
